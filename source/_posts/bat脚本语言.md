title: bat脚本语言
author: PanXiaoKang
cover: 'https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3892555403,2109202179&fm=26&gp=0.jpg'
tags:
  - bat
  - 脚本语言
  - 技能提升
categories:
  - 脚本技术交流
date: 2021-05-16 21:55:00

---

 ## 路由命令解释

route print:打印路由表

打印情况如下：

```
===========================================================================
接口列表
 11...00 ff 92 9f 7d d8 ......HotspotShield TAP-Windows Adapter V9
  4...da 5d e2 3a 81 d7 ......Microsoft Wi-Fi Direct Virtual Adapter
 17...d8 5d e2 3a 81 d7 ......Microsoft Wi-Fi Direct Virtual Adapter #2
  3...68 f7 28 e0 e0 5f ......Realtek PCIe GBE Family Controller
  9...d8 5d e2 3a 81 d7 ......Realtek RTL8723BE Wireless LAN 802.11n PCI-E NIC
 19...d8 5d e2 3a 81 d8 ......Bluetooth Device (Personal Area Network)
  1...........................Software Loopback Interface 1
===========================================================================

IPv4 路由表
===========================================================================
活动路由:
网络目标        网络掩码          网关       接口   跃点数
          0.0.0.0          0.0.0.0    171.16.29.254     171.16.28.65     35
          0.0.0.0          0.0.0.0     192.168.43.1    192.168.43.39     55
         10.0.0.0        255.0.0.0    171.16.29.254     171.16.28.65     36
        127.0.0.0        255.0.0.0            在链路上         127.0.0.1    331
        127.0.0.1  255.255.255.255            在链路上         127.0.0.1    331
  127.255.255.255  255.255.255.255            在链路上         127.0.0.1    331
      171.16.28.0    255.255.254.0            在链路上      171.16.28.65    291
    171.16.29.255  255.255.255.255            在链路上      171.16.28.65    291
        172.0.0.0        255.0.0.0    171.16.29.254     171.16.28.65     36
     192.168.43.0    255.255.255.0            在链路上     192.168.43.39    311
   192.168.43.255  255.255.255.255            在链路上     192.168.43.39    311
        224.0.0.0        240.0.0.0            在链路上         127.0.0.1    331
        224.0.0.0        240.0.0.0            在链路上      171.16.28.65    291
        224.0.0.0        240.0.0.0            在链路上     192.168.43.39    311
  255.255.255.255  255.255.255.255            在链路上         127.0.0.1    331
  255.255.255.255  255.255.255.255            在链路上      171.16.28.65    291
  255.255.255.255  255.255.255.255            在链路上     192.168.43.39    311
===========================================================================
永久路由:
  网络地址          网络掩码  网关地址  跃点数
          0.0.0.0          0.0.0.0     192.168.43.1       1
        172.0.0.0        255.0.0.0    171.16.29.254       1
         10.0.0.0        255.0.0.0    171.16.29.254       1
===========================================================================

IPv6 路由表
===========================================================================
活动路由:
 接口跃点数网络目标                网关
  9     71 ::/0                     fe80::6d3:b5ff:feda:1781
  1    331 ::1/128                  在链路上
  9     71 2409:896a:240:ee0e::/64  在链路上
  9    311 2409:896a:240:ee0e:4e:7fd4:3e44:f208/128
                                    在链路上
  9    311 2409:896a:240:ee0e:79d5:faec:17e5:3e75/128
                                    在链路上
  3    291 fe80::/64                在链路上
  9    311 fe80::/64                在链路上
  9    311 fe80::4e:7fd4:3e44:f208/128
                                    在链路上
  3    291 fe80::8fd:958e:8633:c3e2/128
                                    在链路上
  1    331 ff00::/8                 在链路上
  3    291 ff00::/8                 在链路上
  9    311 ff00::/8                 在链路上
===========================================================================
永久路由:
  无
```

route add:主要作用是添加静态路由

route delete ip地址：删除ip路由地址

通常格式如下：

```
route [-f] [-p] [Command] [Destination] [mask Netmask] [Gateway] [metric Metric] [if Interface]
```

参数含义：

> destination【网段地址】
> mask【子网掩码】
> gateway【网关地址】
> metric 【路由跳数】
> if【端口号】
> 一般情况下，不涉及本机地址，除非你要做测试。

其中：
可以省略【路由跳数】参数；
当通往该网关地址的路径唯一时，【端口号】参数可以省略。（因为在多端口的路由交换设备上，可能存在通往同一个IP地址的多条备份路径。）
mask 是关键字，不能省略。

加上-p 代表就是永久路由，路由就不会失效，重新开机路由依然存在。

## 实现内外网同时访问

在使用华为云桌面时，不能同时访问外网进行上网查询资料等操作，需要编写bat脚本来实现同时访问。

首先查看电脑的网关信息，通过命令`ipconfig`查看：

```
Windows IP 配置

未知适配器 本地连接:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :

无线局域网适配器 本地连接* 1:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :

无线局域网适配器 本地连接* 10:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :

以太网适配器 以太网:

   连接特定的 DNS 后缀 . . . . . . . :
   本地链接 IPv6 地址. . . . . . . . : fe80::8fd:958e:8633:c3e2%3
   IPv4 地址 . . . . . . . . . . . . : 171.16.28.65
   子网掩码  . . . . . . . . . . . . : 255.255.254.0
   默认网关. . . . . . . . . . . . . : 171.16.29.254

无线局域网适配器 WLAN:

   连接特定的 DNS 后缀 . . . . . . . :
   IPv6 地址 . . . . . . . . . . . . : 2409:896a:240:ee0e:4e:7fd4:3e44:f208
   临时 IPv6 地址. . . . . . . . . . : 2409:896a:240:ee0e:79d5:faec:17e5:3e75
   本地链接 IPv6 地址. . . . . . . . : fe80::4e:7fd4:3e44:f208%9
   IPv4 地址 . . . . . . . . . . . . : 192.168.43.39
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . : fe80::6d3:b5ff:feda:1781%9
                                       192.168.43.1

以太网适配器 蓝牙网络连接:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :
```

根据提供的ip地址和网关编写的bat脚本命令如下：

```
echo off
route delete 0.0.0.0
route delete 171.17.1.0
route delete 171.16.28.65
route -p add 0.0.0.0 mask 0.0.0.0 192.168.43.1 IF 4 
route add -p  172.0.0.0 mask 255.0.0.0 171.16.29.254 IF 3
route add -p 10.0.0.0 mask 255.0.0.0 171.16.29.254 IF 3
echo on
```

关于bat脚本命令的解释：

echo off:添加此命令的作用是不会显示所执行的命令，只会给出结果。

echo on:会显示所执行的命令，然后显示执行的结果。

但"echo off"本身的命令会显示出来怎么办，所以一般见到的echo off 前面都有"@"，"@"作用是此行所有的命令都不显示，只执行，和"echo off"比较相似，不过只对当前行起作用。

route delete:每次设置路由，都要把之前设置过的路由删除掉，避免冲突或冗余。

命令：

```
route -p add 0.0.0.0 mask 0.0.0.0 192.168.43.1 IF 4 
```

解释：

192.168.43.1是连接手机热点时无线局域网的默认网关。

IF 4表示端口是4，在route print时可以查看得到接口列表。

```
===========================================================================
接口列表
 11...00 ff 92 9f 7d d8 ......HotspotShield TAP-Windows Adapter V9
  4...da 5d e2 3a 81 d7 ......Microsoft Wi-Fi Direct Virtual Adapter
 17...d8 5d e2 3a 81 d7 ......Microsoft Wi-Fi Direct Virtual Adapter #2
  3...68 f7 28 e0 e0 5f ......Realtek PCIe GBE Family Controller
  9...d8 5d e2 3a 81 d7 ......Realtek RTL8723BE Wireless LAN 802.11n PCI-E NIC
 19...d8 5d e2 3a 81 d8 ......Bluetooth Device (Personal Area Network)
  1...........................Software Loopback Interface 1
===========================================================================
```

命令：

```
route add -p  172.0.0.0 mask 255.0.0.0 171.16.29.254 IF 3
route add -p 10.0.0.0 mask 255.0.0.0 171.16.29.254 IF 3
```

解释：

171.16.29.254是以太网的默认网关。

172.0.0.0、10.0.0.0和255.0.0.0暂时不确定这么设置的作用（但阴差阳错改成功了哈哈）。

IF 3是以太网的端口号，如上接口列表。

使用管理员身份执行脚本后，IPv4路由表会多出刚才添加的活动路由。

```
IPv4 路由表
===========================================================================
活动路由:
网络目标        网络掩码          网关       接口   跃点数
          0.0.0.0          0.0.0.0    171.16.29.254     171.16.28.65     35
          0.0.0.0          0.0.0.0     192.168.43.1    192.168.43.39     55
         10.0.0.0        255.0.0.0    171.16.29.254     171.16.28.65     36
        127.0.0.0        255.0.0.0            在链路上         127.0.0.1    331
```

171.16.28.65是以太网的IPv4的地址。