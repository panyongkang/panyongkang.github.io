title: 贵阳银行项目
author: PanXiaoKang
comments: false
cover: >-
  https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=2215076161,2140044819&fm=26&gp=0.jpg
message: 您好，本篇文章需密码访问，请谅解！
password: card0113
tags:

  - 贵阳银行
  - EsgynDB
  - Oracle
categories:
  - 项目
date: 2020-09-22 12:24:00
---
## 项目背景


此项目是入职了深圳市长亮核心科技有限公司之后，进入项目组学习卡模块和负债模块的业务知识，该项目主要是做贵阳银行、贵阳农商银行的核心业务系统的金融产品。项目成立沙箱子项目是为了将Oracle数据库的数据慢慢迁移到EsgynDB易鲸捷融合分布式数据库中，实现了系统安全、自主、可控。实现了国内传统银行核心系统去“IOE”、数据库国产化的实践方案。易鲸捷数据库的成功上线是国产数据库在金融核心交易领域的重大突破，对于打破国际数据库巨头的垄断地位，加速国产数据库在金融核心交易领域实现全面国产化商用具有里程碑式意义。

去IOE：去掉IBM的小型机、Oracle数据库、EMC存储设备，代之以自己在开源软件基础上开发的系统。

2013年的斯诺登事件，让中国政府意识到使用美国数据库的巨大安全风险，全力推进去IOE化，但实际进展缓慢。尽管很多大型银行已经基于MySQL等开源系统，对非核心业务进行替换，但核心业务仍然在使用IBM DB2系统。


## 技术优势


　　目前大多数银行的核心系统依然采用的是集中式架构，因此传统大行IT团队能力仍在传统集中式核心，即以COBOL语言为基础部署在传统大型机，采用DB2、Oracle等商业数据库，并不具备构建分布式系统的能力。

　　但传统的集中式架构已无法满足目前互联网+金融高用户量、高数据量、高并发的需求，分布式架构技术切换迫切。长亮通过长期自主研发和技术积累，已经成功将Java语言开发的分布式架构核心系统运用在传统银行业务上，可在国产数据库上运行，可部署在X86硬件平台，支持亿级的数据量和亿级的交易量，不依赖于任何特定硬件服务器和系统软件，能够真正支持国内商业银行的国产化替代。

## 业务知识


### 银行卡校验位计算


校验位的计算是在预制卡申请时完成的，预制卡申请阶段就已经生成了卡号。

卡号奇数位之和有两种情况：

1. 当奇数位乘以2大于等于10，则奇数位乘以2与10取余
2. 小于10则乘以2

奇数位总和=以上两种情况分别计算之和

偶数位总和=银行卡号除了最后一位从右到左偶数位之和

例子：贵阳银行卡号：6215529901000000215

从右到左开始数

奇数位有：1 0 0 0 1 9 2 5 2

偶数位有：2 0 0 0 0 9 5 1 6

奇数位之和=1*2+0*2+0*2+0*2+1*2+9*2%10+2*2+5*2%10+2*2
=2+2+9+4+1+4=22

偶数位之和=2+9+5+1+6=23

所以校验位=（10-（奇数位之和+偶数位之和）%10）%10=5

每个银行校验位算法都不同，此算法只是遵循贵阳银行卡号校验位的计算规则。


### 卡号组成规则


<code style="color:#009ad6;">卡号组成公式为“卡号=6位卡BIN号+2位地区+2位卡号种类+8位顺序号+1位校验位”</code>

一般情况下，银行卡号的组成长度为19位，贵阳银行普通借记卡的组成长度是19位，卡号组成公式为“卡号=6位卡BIN号+2位地区+2位卡号种类+8位顺序号+1位校验位”。开立银行卡之前需要建立客户信息，上级库管员领用给一般柜员或自助柜员，柜员尾箱下存在卡凭证，才允许进行发卡处理。



### 交易背景介绍


银行卡凭证的生命周期主要分为申领、使用和销毁三个阶段，从卡凭证种类的角度来讲，是从空白卡-预制卡-正常卡-待销毁卡-作废卡的一个转变的过程。

申领的发卡方式有预制卡发卡和预约卡发卡。预制卡发卡时，确认当日柜员尾箱下的预制卡数量充足，在客户向柜员申请卡片时，柜员就可以直接将卡片发到客户手中，客户就可以使用该卡片从事相关的金融活动。预约卡发卡时，需要客户先向柜面柜员提交申请，柜员尾箱下拿到预约的卡凭证之后，才能发放给客户，客户完成领卡和激活的动作就可以使用了。

在使用阶段，我们除了使用银行卡进行正常的金融活动之外，还可以进行换卡、挂失、改密、激活和销卡的处理。换卡原因一般有正常换卡、卡片到期换卡、损坏换卡、挂失补卡，虚拟卡补实体卡等。当卡片丢失时，可通过口头挂失和正式挂失等方式进行挂失，挂失之后还能进行解挂处理；对于批量发卡时，需要进行卡片的激活处理。实时发卡时卡片已启用，客户领完卡就可以直接使用。代理16周岁以下的开卡操作，需本人携带户口本或身份证等复印件前往银行亲自确认并激活才能使用，否则卡片是仅锁卡状态，只能存入而不能取出。忘记密码时可以进行改密处理。当卡片不再使用时，可进行正常的销卡处理，但若存在签约贷款账户的卡片，需要进行先销户才能进行销卡处理，否则不允许销卡。

在销毁阶段，可分为待销毁卡上缴和销毁两个步骤。适用于吞没卡、拾遗卡、没收卡等卡片的处理。比如客户在ATM机上面连续输错密码3次或将卡片放在取卡口未及时取卡导致卡片被吞没。在一定时间内（15个工作日）银行会代为保管，客户若到银行领取卡片，则将卡片退回。超过规定的保管日期，客户没有到银行领取卡片，银行会将卡片剪卡作销毁处理。

### 个人卡开卡业务流程


**功能描述**

实时单张发个人卡主卡交易主要是为了建立卡与客户之间的关联关系。当客户向柜员申请卡片时，先检查客户信息、产品信息、卡号等基本信息通过之后，调用负债开户构件生成个人活期结算账户与客户账号进行关联，柜员将预制卡发放给客户，最后付出卡凭证的一个过程。  
具体开卡之前的准备工作流程如下：

![个人卡开卡业务流程图](https://s1.ax1x.com/2020/09/22/wOhzTI.png "个人卡开卡业务流程图")


### 交易处理流程


根据业务逻辑代码，以服务为节点绘制交易处理流程图，如图所示：

![实时单张发个人卡交易处理流程图](https://s1.ax1x.com/2020/09/22/wO4pkt.png "实时单张发个人卡交易处理流程图")


### 卡产品介绍


可开立的银行卡有金卡、白金卡、钻石卡、标准金融IC卡、三类账户虚拟卡等卡产品。目前只做借记卡产品，不涉及信用卡产品。借记卡客户最大持卡量一般不超过4张，虚拟卡不超过20张，特殊情况下可授权进行更改。预约卡一般超过15天未领将会被锁卡（金融IC卡和磁条卡除外，且磁条卡已暂停使用）。卡产品的有效期一般为10年，不同的银行有不同的规定。

### 卡产品参数控制


|    参数名称    |                       枚举值                       |                           控制描述                           |
| :------------: | :------------------------------------------------: | :----------------------------------------------------------: |
|    卡BIN号     |                         无                         |  卡BIN号是银行通过银联申请得到的号码，一般为6位，不可修改。  |
|    卡号种类    |                         无                         |     卡号种类一般为2位，允许修改，不同银行有不同的规定。      |
|     卡介质     | 0-磁条卡；1-IC卡；2-复合卡；3-虚拟卡；4-纯电子现金 | 磁条卡是指在卡片上印制磁条信息，通过读取和比对实现支付、转账等交易的银行卡；IC卡内含一块集成芯片，可以实现复杂的运算的银行卡；复合卡作为金融IC卡的过渡卡种，同时支持芯片和磁条两种介质；虚拟卡是指用于无卡支付的虚拟账户，没有实体卡；纯电子现金指的是以数字形式存在，可在互联网流通的电子现金。 |
|    卡种性质    |           0-借记卡；1-贷记卡；2-准贷记卡           | 借记卡指的是储蓄卡，先存款再取出且没有透支功能的银行卡；贷记卡和准贷记卡都是指信用卡，在规定额度范围内先消费后还款，具有透支功能的银行卡。 |
|     卡对象     |                 0-个人卡；1-单位卡                 | 个人卡是指银行向个人，包括居住在城镇的工人、干部、教师、科技工作者、个体经济户等发行的银行卡；单位卡是指银行向企业、事业单位、学校、机关、团体、部队等单位发行的银行卡。 |
|     卡种类     |                 0-普通卡；1-联名卡                 | 两者都能满足用户的存取、消费、转账等需求。主要区别在于联名卡会享有更有特色的权益和卡面。例如：货车帮联名卡，持该卡在货车帮旗下门店进行车辆维修、购置汽车配件、缴纳信息服务费、管理费等可享受一定折扣优惠。 |
| 客户最大持卡量 |                         无                         | 借记卡不超过4张，虚拟卡不超过20张；特殊情况下，需授权通过才允许进行更改。 |
| 未领卡锁定天数 |                         无                         | 事后卡一般超过15天未领卡会被锁定（仅锁卡），不同银行规定不同。 |



### 负债产品介绍


开个人借记卡默认是开立个人活期账户，一般可选择一类账户、二类账户和三类账户，账户分别对应的产品为个人活期存款、II类活期产品、III类活期产品。开一、二、三类户的目的主要是在一类账户的基础功能上面逐级递减，资产风险依次递减的作用。

一、二、三类账户的差别如下表所示：

| 账户分类 |   对应产品    |   账户余额   |          使用限额           |        账户形式        |           主要功能           |
| :------: | :-----------: | :----------: | :-------------------------: | :--------------------: | :--------------------------: |
| 一类账户 | 个人活期存款  |    不限制    |           不限制            | 储蓄卡、借记卡及存折等 | 可存取款、理财、消费和转账等 |
| 二类账户 | II类活期产品  |    不限制    | 单日限额1万元；年限额20万元 | 电子账户（可配实体卡） | 可存取款、理财、消费、转账等 |
| 三类账户 | III类活期产品 | 不超过1000元 | 单日限额5千元；年限额10万元 |   电子账户，无实体卡   |  消费、缴费等小额高频的交易  |


### 负债产品参数控制


|    字段中文名    |                            枚举值                            |                           控制描述                           |
| :--------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|   产品定活标志   |                   0-活期产品；  1-定期产品                   | 个人开卡一般开立的是活期产品，但银行卡既可以开活期产品也可以开定期产品。 |
|   产品所属对象   |       1-对私存款产品； 2-对公存款产品； 3-同业存款产品       | 个人开卡面向的是对私存款产品，单位开卡面向的是对公存款产品、同业存款产品 |
|     产品类型     |                   0-传统产品；  1-扩展产品                   |        一类账户属于传统产品，二、三类账户属于扩展产品        |
|   产品默认币种   |                  156-人民币；  其余略。。。                  |                目前所有产品默认币种都是人民币                |
|     通兑范围     | 2-全行通兑；  0-开户机构通兑；  1-分行通兑；  3-核算机构通兑 | 一、二、三类户的通兑范围为全行通兑；  个人活期产品一般为全行通兑，单位活期产品为开户机构通兑或核算机构通兑；分行通兑目前没有此业务。 |
|     通存范围     | 2-全行通存；  0-开户机构通存；  1-分行通存；  3-核算机构通存 | 一、二、三类户的通存范围为全行通存；  个人活期产品一般为全行通存，单位活期产品为开户机构通兑或核算机构通存；分行通存目前没有此业务。 |
| 是否形态转移定义 |                         0-否；  1-是                         |         活期账户允许形态转移，定期账户不允许形态转移         |



### 会计分录


概念：会计分录是指根据经济业务的内容，对每项经济业务列出应借、应贷账户名称及其金额的一种记录。

复式记账法的种类有借贷记账法、增减记账法和收付记账法。下面的会计分录用到的是借贷记账法，它有一个平衡公式是“资产=负债+所有者权益”，以“借”和“贷”为记账符号，以“有借必有贷，借贷必相等”为原则进行审查。

1. 现金开卡会计分录：

借： 现金尾箱

贷： 客户账户

2.  转账开卡会计分录：

借： 转出客户账号 

贷： 转入客户账号

现金尾箱属于资产类科目，遵循借增贷减原则，客户账户属于负债类科目，遵循借减贷增原则。卡凭证应用的是收付记账法进行记账。


## 同时使用内网和外网


1.先以管理员身份运行 <code style="color:blue;"><a href="#a">route-贵阳银行.bat</a></code> 的脚本

2.若出现路由添加失败，对象已存在，说明之前添加过路由

3.以管理员身份打开cmd窗口

4.执行route delete 172.0.0.0，将原先的记录清除

5.然后再以管理员身份执行<code style="color:blue;">route-贵阳银行.bat</code> 的脚本

6.提示成功，这时就可以同时使用无线网和虚拟桌面了

<div id="a">route脚本语法命令如下:</div>

```
@echo off
route delete 0.0.0.0
route add -p  172.0.0.0 mask 255.0.0.0 174.16.28.254
route add -p  10.0.0.0 mask 255.0.0.0 174.16.28.254
pause
```

其中：echo on的意思是显示命令回显；echo off的意思就是关闭命令回显；@的意思就是不让同行的命令显示；@ECHO OFF的意思就是不显示ECHO OFF和它后面的命令回显。